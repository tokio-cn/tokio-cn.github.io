<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <link rel="apple-touch-icon" sizes="120x120" href="https://tokio-cn.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://tokio-cn.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://tokio-cn.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://tokio-cn.github.io/manifest.json">
    <link rel="mask-icon" href="https://tokio-cn.github.io/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">

    
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/bootstrap-reboot.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/bootstrap.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/tokio.css">

    
    <link rel="alternate" type="application/rss+xml" href="https://tokio-cn.github.io/blog/index.xml" />

    <title>Announcing the Tokio runtime</title>
  </head>
  <body>
    <header class="navbar navbar-light navbar-toggleable-md bd-navbar">
      <nav class="tk-main-nav">
        <div class="d-flex justify-content-between hidden-lg-up">
            <a href="https://tokio-cn.github.io/" class="navbar-brand">
              <img src="https://tokio-cn.github.io/img/logo.png" class="align-middle" alt="">
            </a>
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#tk-main-nav" aria-label="Toggle navigation" aria-controls="tk-main-nav" aria-expanded="false">
              <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        <div class="navbar-collapse collapse" id="tk-main-nav">
          <ul class="nav navbar-nav">
            <li class="nav-item hd-lg-down">
              <a class="navbar-brand" href="https://tokio-cn.github.io/"><img src="https://tokio-cn.github.io/img/logo.png" class="align-middle" alt=""></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://tokio-cn.github.io/">首页 <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://tokio-cn.github.io/docs/getting-started/hello-world/">文档</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://tokio-cn.github.io/community/">社区</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://tokio-cn.github.io/blog/2018-05-tokio-fs/">博客</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>



<div class="tk-pageheader">
  <div class="container">
    <h1 class="display-4">Announcing the Tokio runtime</h1>
    <p class="lead">08 March 2018</p>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-3">

      <nav class="leftnav">
        <div class="" id="">
          <ul class="nav">
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2018-05-tokio-fs/" class="text-muted">New Tokio release, now with filesystem support</a>
            </li>
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2018-03-timers/" class="text-muted">New Timer implementation</a>
            </li>
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2018-03-tokio-runtime/" >Announcing the Tokio runtime</a>
            </li>
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2018-02-tokio-reform-shipped/" class="text-muted">Tokio Reform is Shipped and the Road to 0.2</a>
            </li>
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2017-09-tokio-reform/" class="text-muted">An RFC for a Tokio revamp</a>
            </li>
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2017-03-tokio-io/" class="text-muted">Announcing the tokio-io Crate</a>
            </li>
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2017-01-tokio-0-1/" class="text-muted">Announcing Tokio 0.1</a>
            </li>
            
          </ul>
        </div>
      </nav>

    </div>
    <div class="col-md-9">
      <div class="tk-content">
        

<p>I&rsquo;m happy to announce a new release of Tokio. This release includes the first
iteration of the Tokio Runtime.</p>

<h2 id="tl-dr">tl;dr</h2>

<p>This is how a multi-threaded Tokio based server is now written:</p>

<pre><code class="language-rust,ignore">extern crate tokio;

use tokio::net::TcpListener;
use tokio::prelude::*;

fn process(s: TcpStream)
  -&gt; impl Future&lt;Item = (), Error = ()&gt; + Send
{ ... }

let addr = &quot;127.0.0.1:8080&quot;.parse().unwrap();
let listener = TcpListener::bind(&amp;addr).unwrap();

let server = listener.incoming()
    .map_err(|e| println!(&quot;error = {:?}&quot;, e))
    .for_each(|socket| {
        tokio::spawn(process(socket))
    });

tokio::run(server);
</code></pre>

<p>where <code>process</code> represents a user defined function that takes a socket and
returns a future that process it. In the case of an echo server, that might be
reading all data from the socket and writing it back to the same socket.</p>

<p>The <a href="https://tokio-cn.github.io/docs/getting-started/hello-world/">guides</a> and <a href="https://github.com/tokio-rs/tokio/tree/master/examples">examples</a> have been updated to use the runtime.</p>

<h2 id="what-is-the-tokio-runtime">What is the Tokio Runtime?</h2>

<p>The Rust asynchronous stack is evolving to a set of loosely coupled components.
To get a basic networking application running, you need at a minimum an
asynchronous task executor and an instance of the Tokio reactor. Because
everything is decoupled, there are multiple options for these various
components, but this adds a bunch of boilerplate to all apps.</p>

<p>To help mitigate this, Tokio now provides the concept of a runtime. This is a
pre-configured package of all the various components that are necessary for
running the application.</p>

<p>This initial release of the runtime includes the reactor as well as a
<a href="https://en.wikipedia.org/wiki/Work_stealing">work-stealing</a> based thread pool for scheduling and executing the application&rsquo;s
code. This provides a multi-threaded default for applications.</p>

<p>The work-stealing default is ideal for most applications. It uses a similar
strategy as Go, Erlang, .NET, Java (the ForkJoin pool), etc&hellip; The
implementation provided by Tokio is designed for use cases where many
<strong>unrelated</strong> tasks are multiplexed on a single thread pool.</p>

<h2 id="using-the-tokio-runtime">Using the Tokio Runtime</h2>

<p>As illustrated in the example above, the easiest way to use the Tokio runtime
is with two functions:</p>

<ul>
<li><code>tokio::run</code></li>
<li><code>tokio::spawn</code>.</li>
</ul>

<p>The first function takes a future to seed the application and starts the
runtime. Roughly, it does the following:</p>

<ol>
<li>Start the reactor.</li>
<li>Start the thread pool.</li>
<li>Spawn the future onto the thread pool.</li>
<li>Blocks the thread until the runtime becomes idle.</li>
</ol>

<p>The runtime becomes idle once <strong>all</strong> spawned futures have completed and <strong>all</strong>
I/O resources bound to the reactor are dropped.</p>

<p>From within the context of a runtime. The application may spawn additional
futures onto the thread pool using <code>tokio::spawn</code>.</p>

<p>Alternatively, the <a href="#"><code>Runtime</code></a> type can be used directly. This allows for more
flexibility around setting up and using the runtime.</p>

<h2 id="future-improvements">Future improvements</h2>

<p>This is just the initial release of the Tokio runtime. Upcoming releases will
include additional functionality that is useful for Tokio based applications. A
blog post will be coming soon that goes into the roadmap in more detail.</p>

<p>The goal, as mentioned before, is to release early and often. Providing new
features to enable the community to experiment with them. Sometime in the next
few months, there will be a breaking release of the entire Tokio stack, so any
changes in the API need to be discovered before then.</p>

<h2 id="tokio-core">Tokio-core</h2>

<p>There has also been a new release of <code>tokio-core</code>. This release updates
<code>tokio-core</code> to use <code>tokio</code> under the hood. This enables all existing
applications and libraries that currently depend on <code>tokio-core</code> (like Hyper) to
be able to use the improvements that come with the Tokio runtime without
requiring a breaking change.</p>

<p>Given the amount of churn that is expected to happen in the next few months,
we&rsquo;re hoping to help ease the transition across releases.</p>

        
        <div class="tk-next"><b>下一篇</b>：<a href = /blog/2018-02-tokio-reform-shipped/>
         Tokio Reform is Shipped and the Road to 0.2</a></div>
      </div>
    </div>
  </div>
</div>

    <footer class="tk-footer">
      <div class="text-muted tk-footer-gray d-flex justify-content-between">
        <div class="tk-footer-info">
          版权所有 © 2018 <a href="https://tokio.rs">Tokio 项目（作）</a> & <a href="https://hltj.me">灰蓝天际（译）</a>
        </div>
        <div class="tk-footer-social">
          <a href="https://twitter.com/tokio_rs" class="text-muted"><i class="fa fa-twitter" aria-hidden="true"></i></a>
          <a href="https://github.com/tokio-rs/tokio" class="text-muted"><i class="fa fa-github" aria-hidden="true"></i></a>
        </div>
      </div>
    </footer>

    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
    <script src="https://tokio-cn.github.io/js/bootstrap.min.js"></script>
    <script src="https://tokio-cn.github.io/js/highlight.js"></script>
    <script>
      $(function () {
        $("pre code").each(function(i, block) {
          
          if (block.className.indexOf('language-rust') >= 0) {
            var new_content = '';
            var lines = block.textContent.split('\n');
            for (var i = 0; i < lines.length; i++) {
              if (lines[i].indexOf('# ') == 0 || lines[i] == '#') {
                continue
              }
              new_content += lines[i].trimRight() + '\n';
            }
            block.textContent = new_content.replace(/\n\n\n/g, "\n\n").trimRight();
          }
          hljs.highlightBlock(block);
        });
      });
    </script>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-122396021-1', 'auto');
ga('send', 'pageview');
</script>

  </body>
</html>


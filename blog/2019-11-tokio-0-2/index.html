<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <link rel="apple-touch-icon" sizes="120x120" href="https://tokio-cn.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://tokio-cn.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://tokio-cn.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://tokio-cn.github.io/manifest.json">
    <link rel="mask-icon" href="https://tokio-cn.github.io/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">

    
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/bootstrap-reboot.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/bootstrap.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/tokio.css">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/>

    
    <link rel="alternate" type="application/rss+xml" href="https://tokio-cn.github.io/blog/index.xml" />

    <title>
      
        Announcing Tokio 0.2 and a Roadmap to 1.0 · Tokio 中文站
      
    </title>
  </head>
  <body>
    <header class="navbar navbar-expand navbar-dark flex-column flex-md-row tk-navbar">
      <a class="navbar-brand" href="https://tokio-cn.github.io/">
        <img src="https://tokio-cn.github.io/img/Tokio_Mark_White.png" class="align-middle" alt="">
      </a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link " href="https://tokio-cn.github.io/">首页</a>
          </li>
          <li class="nav-item">
            
            
            
            <a class="nav-link " href="https://tokio-cn.github.io/docs/getting-started/hello-world/">文档</a>
          </li>
          <li class="nav-item">
            
            <a class="nav-link " href="https://tokio-cn.github.io/community/">社区</a>
          </li>
          <li class="nav-item">
            
            
            <a class="nav-link  active " href="https://tokio-cn.github.io/blog/2019-11-tokio-0-2/">博客</a>
          </li>
        </ul>
      </div>

      <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex">
        <li class="nav-item dropdown">
          <a class="nav-item nav-link dropdown-toggle mr-md-2" href="#" id="tk-langs" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            中文
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="tk-langs">
            <a class="dropdown-item active" href="#">中文</a>
            <a class="dropdown-item" href="https://tokio-zh.github.io/" rel="nofollow">官方中文</a>
            <a class="dropdown-item" href="https://tokio.rs" rel="nofollow">English</a>
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://github.com/tokio-rs/tokio" target="_blank" rel="noopener" aria-label="GitHub">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false"><title>GitHub</title><path d="M256 0C114.64 0 0 114.61 0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34 0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49 0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75 0 0 21.49-6.88 70.4 26.24a242.65 242.65 0 0 1 128.18 0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69 0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41 0 34.22-.31 61.83-.31 70.23 0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37 0 256 0z" fill="currentColor" fill-rule="evenodd"/></svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://twitter.com/tokio_rs" target="_blank" rel="noopener" aria-label="Twitter">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 416.32" focusable="false"><title>Twitter</title><path d="M160.83 416.32c193.2 0 298.92-160.22 298.92-298.92 0-4.51 0-9-.2-13.52A214 214 0 0 0 512 49.38a212.93 212.93 0 0 1-60.44 16.6 105.7 105.7 0 0 0 46.3-58.19 209 209 0 0 1-66.79 25.37 105.09 105.09 0 0 0-181.73 71.91 116.12 116.12 0 0 0 2.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48 0 0 0 68 159.6a106.27 106.27 0 0 1-47.53-13.11v1.43a105.28 105.28 0 0 0 84.21 103.06 105.67 105.67 0 0 1-47.33 1.84 105.06 105.06 0 0 0 98.14 72.94A210.72 210.72 0 0 1 25 370.84a202.17 202.17 0 0 1-25-1.43 298.85 298.85 0 0 0 160.83 46.92" fill="currentColor"/></svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://gitter.im/tokio-rs/tokio" target="_blank" rel="noopener" aria-label="Gitter">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" focusable="false"><title>Gitter</title><path fill="currentColor" d="M8.501 4.001H10.5V24H8.501V4.001zm6.999 0V24h-2V4.001h2zM3.5 0h2.001v15H3.5V0zm15 4.001h2V15h-2V4.001z"/></svg>
          </a>
        </li>
      </ul>
    </header>



<div class="container-fluid tk-blog">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 tk-sidebar">
      
      <div class="tk-docs-toggle d-md-none p-0 d-flex ml-3 collapsed align-item-center">
        <h1 class="tk-title">Announcing Tokio 0.2 and a Roadmap to 1.0</h1>
        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#tk-docs-nav" aria-controls="tk-docs-nav" aria-expanded="false" aria-label="Toggle docs navigation">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"></path></svg>
        </button>
      </div>
      <nav class="tk-links collapse" id="tk-docs-nav">
          <div class="tk-toc-item active">
            <p class="tk-toc-link">
              博文列表
            </p>
            <ul class="nav tk-sidenav">
              
              
                  <li><a href="https://tokio-cn.github.io/blog/2019-11-tokio-0-2/" class="active">Announcing Tokio 0.2 and a Roadmap to 1.0</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2019-10-scheduler/" class="">Making the Tokio scheduler 10x faster</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2019-08-tracing/" class="">Diagnostics with Tracing</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2019-08-alphas/" class="">Tokio alpha release with async &amp; await</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2018-12-recap-2018/" class="">A great 2018, an even better 2019</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2018-10-doc-blitz/" class="">Announcing the Tokio Doc Push (we need you!)</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2018-08-async-await/" class="">Experimental async / await support for Tokio</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2018-08-incremental-improvements/" class="">Tokio 0.1.8 with many incremental improvements</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2018-05-tokio-fs/" class="">New Tokio release, now with filesystem support</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2018-03-timers/" class="">New Timer implementation</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2018-03-tokio-runtime/" class="">Announcing the Tokio runtime</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2018-02-tokio-reform-shipped/" class="">Tokio Reform is Shipped and the Road to 0.2</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2017-09-tokio-reform/" class="">An RFC for a Tokio revamp</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2017-03-tokio-io/" class="">Announcing the tokio-io Crate</a></li>
              
                  <li><a href="https://tokio-cn.github.io/blog/2017-01-tokio-0-1/" class="">Announcing Tokio 0.1</a></li>
              
            </ul>
          </div>
      </nav>
    </div>
    <div class="d-none d-xl-block col-xl-2 tk-toc">
      <div class="section-nav">
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#async-await"><code>async / await</code></a></li>
<li><a href="#a-new-scheduler">A new scheduler</a></li>
<li><a href="#a-lightweight-tokio-dependency">A lightweight Tokio dependency</a></li>
</ul></li>
<li><a href="#thanks">Thanks</a></li>
<li><a href="#a-roadmap-to-1-0">A Roadmap to 1.0</a>
<ul>
<li><a href="#tokio-1-0-in-q3-2020-with-lts-support">Tokio 1.0 in Q3 2020 with LTS support</a></li>
<li><a href="#how-to-get-there">How to get there</a></li>
<li><a href="#what-is-expected-to-change">What is expected to change</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
      </div>

    </div>
    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 tk-content tk-docs">
      <h1 class="tk-title">Announcing Tokio 0.2 and a Roadmap to 1.0</h1>
      <p class="tk-date">November 26, 2019</p>
      
      

<p>We are very excited to announce Tokio 0.2. This is a ground up rework of Tokio
based on <code>async / await</code> and experience gained over the past three years.</p>

<p>Add the following to <code>Cargo.toml</code>:</p>

<pre><code class="language-toml">tokio = { version = &quot;0.2&quot;, features = [&quot;full&quot;] }
</code></pre>

<p>This is a major update, and as such there are changes to almost all parts of the
library. To highlight a few:</p>

<ul>
<li><p>Based on <code>async / await</code> for superior ergonomics.</p></li>

<li><p>A brand new, much faster, scheduler.</p></li>

<li><p>Focus on making the Tokio dependency as lightweight as possible.</p></li>
</ul>

<h3 id="async-await"><code>async / await</code></h3>

<p>If you have used Tokio to date, then you are familiar with the &ldquo;old&rdquo; way of
writing asynchronous Rust&hellip; it was not fun. Most ended up writing state
machines by hand. This was cumbersome and error prone.</p>

<p>As of Rust 1.39, the <code>async / await</code> is available on the stable channel and
Tokio 0.2 takes full advantage of it. Whenever possible, Tokio provides an
<code>async fn</code> based API, usually modeled after <code>std</code>.</p>

<p>For example, accepting sockets from a <code>TcpListener</code> is done with the async
<code>accept</code> function:</p>

<pre><code class="language-rust,ignore">let (mut socket, _peer_addr) = listener.accept().await?;
</code></pre>

<p>I/O operations are provided as <code>async</code> functions:</p>

<pre><code class="language-rust,ignore">let n = socket.read(&amp;mut buf).await?;

let n = socket.write(&amp;buf).await?;
</code></pre>

<p>The same applies to the rest of the Tokio API surface.</p>

<p><strong>Starting the Tokio runtime</strong></p>

<p>Setting the entry point of a Tokio application can now be done with a proc macro:</p>

<pre><code class="language-rust,ignore">#[tokio::main]
async fn main() {
    println!(&quot;Hello from Tokio!&quot;);
}
</code></pre>

<p>This starts up the Tokio runtime and all necessary infrastructure to power the
application.</p>

<h3 id="a-new-scheduler">A new scheduler</h3>

<p>The new Tokio comes with a scheduler that was built from the ground up to take
advantage of the new asynchronous task system. It is based on the experience
gained from Tokio 0.1 as well as all the hard work put into <strong>other</strong> ecosystems
like Go, Erlang, Java, and others.</p>

<p>There are still improvements to make, but initial testing using <a href="https://hyper.rs">Hyper</a> shows a
30+% speed up in macro level benchmarks between the old scheduler and the new
scheduler.</p>

<p>You can read more about it <a href="https://tokio.rs/blog/2019-10-scheduler/">here</a>.</p>

<p>Since it landed on master, some Tokio users have been experimenting with the new
scheduler and have seen some very impressive real world improvements in their
applications. Hopefully they will blog about them soon!</p>

<h3 id="a-lightweight-tokio-dependency">A lightweight Tokio dependency</h3>

<p>One of the biggest complaints users have about Tokio to date is the weight of
the depenedency. Adding a dependency on Tokio has historically added a large
number of transitive dependencies and added time spent compiling.</p>

<p>For example, a &ldquo;hello world&rdquo; Tokio 0.1 application on my laptop would pull in 43
crates and take 50 seconds to compile (not counting time spent downloading the
dependencies).</p>

<p>Tokio addresses this issue on two fronts. First, most Tokio components have been
collapsed into a single crate: <code>tokio</code> and transitive dependencies were pruned
aggressively. Second, Tokio components have been made <strong>opt-in</strong> using feature
flags instead of always on. Simply pulling in the <code>tokio</code> dependency will only
get you a few traits.</p>

<p>To get started with Tokio 0.2, you will need to request feature flags. A <code>full</code>
feature flag includes everything and is an easy way to get started:</p>

<pre><code class="language-toml">tokio = { version = &quot;0.2&quot;, features = [&quot;full&quot;] }
</code></pre>

<p>On my laptop, this reduces the total number of crates to 23. Compile time only
drops to 40 seconds.</p>

<p>Real benefits start happening when the user of Tokio starts only requesting the
components that are needed to run the application. To run the TCP echo server
example, the <code>io-util</code>, <code>rt-threaded</code>, and <code>tcp</code> feature flags are needed. Now,
Tokio pulls in 13 crates and compiling takes <strong>13 seconds</strong>.</p>

<p>There is more work to be done on pruning dependencies. Mio 0.7, which prunes
further dependencies, is not included with Tokio 0.2. Tokio 0.3 will include Mio
0.7.</p>

<h2 id="thanks">Thanks</h2>

<p>Of course, none of this would be possible without our amazing team and
contributors who worked on this release. Many individuals submitted PRs ranging
from doc fixes to migrating entire crates to <code>std::future::Future</code>. Some names I
want to call out, in no particular order:</p>

<ul>
<li><a href="https://github.com/hawkw">@hawkw</a></li>
<li><a href="https://github.com/ipetkov">@ipetkov</a></li>
<li><a href="https://github.com/jonhoo">@jonhoo</a></li>
<li><a href="https://github.com/LucioFranco">@LucioFranco</a></li>
<li><a href="https://github.com/seanmonstar">@seanmonstar</a></li>
<li><a href="https://github.com/taiki-e">@taiki-e</a></li>
</ul>

<p>A pre-emptive thanks to all those working on Mio 0.7, which sadly didn&rsquo;t make
the cut for this release, but will happen soon!</p>

<ul>
<li><a href="https://github.com/dtacalau">@dtacalau</a></li>
<li><a href="https://github.com/kleimkuhler">@kleimkuhler</a></li>
<li><a href="https://github.com/PerfectLaugh">@PerfectLaugh</a></li>
<li><a href="https://github.com/piscisaureus">@piscisaureus</a></li>
<li><a href="https://github.com/Thomasdezeeuw">@Thomasdezeeuw</a></li>
</ul>

<p>And a big thanks to <a href="https://buoyant.io/">Buoyant</a>, the makers of <a href="https://github.com/linkerd/linkerd2">Linkerd</a> (the proxy is written in
Rust), who sponsored most of the work.</p>

<h2 id="a-roadmap-to-1-0">A Roadmap to 1.0</h2>

<p>All that being said, we are shipping version 0.2. The question of &ldquo;why not 1.0?&rdquo;
has come up a few times. After all, Tokio 0.1 has been stable for three years.
The short answer: because it isn&rsquo;t time. There is nobody who would rather ship a
Tokio 1.0 than us. It also isn&rsquo;t something to rush.</p>

<p>After all, <code>async / await</code> only landed in the stable Rust channel weeks ago.
There has been no significant production validation yet, except maybe fuchsia
and that seems like a fairly specialized use case. This release of Tokio
includes significant new code and new strategies with feature flags. Also, there
are still big open questions, such as the <a href="https://github.com/tokio-rs/tokio/pull/1744">proposed changes</a> to
<code>AsyncRead</code> and <code>AsyncWrite</code>.</p>

<p>Tokio 1.0 will be released as soon as the APIs are proven to handle real-world
production cases.</p>

<h3 id="tokio-1-0-in-q3-2020-with-lts-support">Tokio 1.0 in Q3 2020 with LTS support</h3>

<p>The Tokio 1.0 release will be <strong>no later</strong> than Q3 2020. It will also come with
&ldquo;long-term support&rdquo; guarantees:</p>

<ul>
<li>A minimum of 5 years of maintenance.</li>
<li>A minimum of 3 years before a hypothetical 2.0 release.</li>
</ul>

<p>When Tokio 1.0 is released in Q3 2020, on-going support, security fixes, and
critical bug fixes are guaranteed until <strong>at least</strong> Q3 2025. Tokio 2.0 will not
be released until <strong>at least</strong> Q3 2023 (though, ideally there will never been a
Tokio 2.0 release).</p>

<h3 id="how-to-get-there">How to get there</h3>

<p>While Tokio 0.1 probably should have been a 1.0, Tokio 0.2 will be a <strong>true</strong>
0.2 release. There will breaking change releases every 2 ~ 3 months until 1.0.
These changes will be <strong>much</strong> smaller than going from 0.1 -&gt; 0.2. It is
expected that the 1.0 release will look a lot like 0.2.</p>

<h3 id="what-is-expected-to-change">What is expected to change</h3>

<p>The biggest change will be the <code>AsyncRead</code> and <code>AsyncWrite</code> traits. Based on
experience gained over the past 3 years, there are a couple of issues to
address:</p>

<ul>
<li>Be able to <strong>safely</strong> use uninitialized memory as a read buffer.</li>
<li>Practical read vectored and write vectored APIs.</li>
</ul>

<p>There are a few strategies to solve these problems. These strategies need to be
investigated and the solution validated. You can see <a href="https://github.com/tokio-rs/tokio/pull/1744#issuecomment-553575438">this comment</a> for a
detailed statement of the problem.</p>

<p>The other major change, which has been in the works for a while, is updating
Mio. Mio 0.6 was first released almost 4 years ago and has not had a breaking
change since. Mio 0.7 has been in the works for a while. It includes a full
rewrite of the windows support as well as a refined API. More will be written
about this shortly.</p>

<p>Finally, now that the API is starting to stabilize, effort will be put into
documentation. Tokio 0.2 is being released before updating the website and many
of the old content will no longer be relevant. In the coming weeks, expect to
see updates there.</p>

<p>So, we have our work cut out for us. We hope you enjoy this 0.2 release and are
looking forward to your feedback and help.</p>

      

      
        <div class="tk-next">
          <b>下一篇</b>：<a href ="/blog/2019-10-scheduler/">Making the Tokio scheduler 10x faster</a>
        </div>
      
    </main>
  </div>
</div>

    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
    <script src="https://tokio-cn.github.io/js/bootstrap.min.js"></script>
    <script src="https://tokio-cn.github.io/js/highlight.js"></script>
    <script>
      $(function () {
        $("pre code").each(function(i, block) {
          
          if (block.className.indexOf('language-rust') >= 0) {
            var new_content = '';
            var lines = block.textContent.split('\n');
            for (var i = 0; i < lines.length; i++) {
              if (lines[i].indexOf('# ') == 0 || lines[i] == '#') {
                continue
              }
              new_content += lines[i].trimRight() + '\n';
            }
            block.textContent = new_content.replace(/\n\n\n/g, "\n\n").trimRight();
          }
          hljs.highlightBlock(block);
        });
      });
    </script>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script type="text/javascript"> docsearch({
    apiKey: 'd7b5b785798fe748621bcaa8301a2201',
    indexName: 'tokio',
    inputSelector: '#search-input',
    debug: false 
    });
    </script>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-122396021-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  </body>
</html>


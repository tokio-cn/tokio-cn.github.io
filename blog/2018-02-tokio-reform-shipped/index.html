<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <link rel="apple-touch-icon" sizes="120x120" href="https://tokio-cn.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://tokio-cn.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://tokio-cn.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://tokio-cn.github.io/manifest.json">
    <link rel="mask-icon" href="https://tokio-cn.github.io/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">

    
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/bootstrap-reboot.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/bootstrap.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/tokio.css">

    
    <link rel="alternate" type="application/rss+xml" href="https://tokio-cn.github.io/blog/index.xml" />

    <title>Tokio Reform is Shipped and the Road to 0.2</title>
  </head>
  <body>
    <header class="navbar navbar-light navbar-toggleable-md bd-navbar">
      <nav class="tk-main-nav">
        <div class="d-flex justify-content-between hidden-lg-up">
            <a href="https://tokio-cn.github.io/" class="navbar-brand">
              <img src="https://tokio-cn.github.io/img/logo.png" class="align-middle" alt="">
            </a>
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#tk-main-nav" aria-label="Toggle navigation" aria-controls="tk-main-nav" aria-expanded="false">
              <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        <div class="navbar-collapse collapse" id="tk-main-nav">
          <ul class="nav navbar-nav">
            <li class="nav-item hd-lg-down">
              <a class="navbar-brand" href="https://tokio-cn.github.io/"><img src="https://tokio-cn.github.io/img/logo.png" class="align-middle" alt=""></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://tokio-cn.github.io/">首页 <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://tokio-cn.github.io/docs/getting-started/hello-world/">文档</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://tokio-cn.github.io/community/">社区</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://tokio-cn.github.io/blog/2018-05-tokio-fs/">博客</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>



<div class="tk-pageheader">
  <div class="container">
    <h1 class="display-4">Tokio Reform is Shipped and the Road to 0.2</h1>
    <p class="lead">07 February 2018</p>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-3">

      <nav class="leftnav">
        <div class="" id="">
          <ul class="nav">
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2018-05-tokio-fs/" class="text-muted">New Tokio release, now with filesystem support</a>
            </li>
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2018-03-timers/" class="text-muted">New Timer implementation</a>
            </li>
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2018-03-tokio-runtime/" class="text-muted">Announcing the Tokio runtime</a>
            </li>
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2018-02-tokio-reform-shipped/" >Tokio Reform is Shipped and the Road to 0.2</a>
            </li>
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2017-09-tokio-reform/" class="text-muted">An RFC for a Tokio revamp</a>
            </li>
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2017-03-tokio-io/" class="text-muted">Announcing the tokio-io Crate</a>
            </li>
            
            <li class="active">
              <a href="https://tokio-cn.github.io/blog/2017-01-tokio-0-1/" class="text-muted">Announcing Tokio 0.1</a>
            </li>
            
          </ul>
        </div>
      </nav>

    </div>
    <div class="col-md-9">
      <div class="tk-content">
        

<p>Hi all!</p>

<p>I&rsquo;m happy to announce that today, the changes proposed in the <a href="https://github.com/tokio-rs/tokio-rfcs/blob/master/text/0001-tokio-reform.md">reform RFC</a> have
been released to <a href="https://crates.io/crates/tokio">crates.io</a> as <code>tokio</code> 0.1.</p>

<p>The primary changes are:</p>

<ul>
<li><p>Add a <em>default</em> global event loop, eliminating the need for setting up and
managing your own event loop in the vast majority of cases.</p></li>

<li><p>Decouple all task execution functionality from Tokio.</p></li>
</ul>

<h2 id="the-new-global-event-loop">The new global event loop</h2>

<p>Up until today, creating an event loop was a manual process. Even though the
vast majority of Tokio users would setup the reactor to do the same thing,
everyone had to do it each time. This was partially due to the fact that there
was a significant difference between running code on the Tokio reactor&rsquo;s thread
or from another thread (like a thread pool).</p>

<p>The key insight that allowed for the Tokio reform changes is that the Tokio
reactor doesn&rsquo;t actually have to be an executor. In other words, prior to these
changes, the Tokio reactor would both power I/O resources <strong>and</strong> manage
executing user submitted tasks.</p>

<p>Now, Tokio provides a reactor to drive I/O resources (like <code>TcpStream</code> and
<code>UdpSocket</code>) separately from the task executor. This means that it is easy to
create Tokio-backed networking types from <em>any</em> thread, making it easy to create
either single or multi threaded Tokio-backed apps.</p>

<p>For task execution, Tokio provides the <a href="https://docs.rs/tokio/0.1/tokio/executor/current_thread/index.html"><code>current_thread</code></a> executor, which
behaves similarly to how the built-in tokio-core executor did. The plan is to
eventually move this executor into the <a href="https://github.com/rust-lang-nursery/futures-rs"><code>futures</code></a> crate, but for now it is
provided directly by Tokio.</p>

<h2 id="the-road-to-0-2">The road to 0.2</h2>

<p>The Tokio reform changes have been released as 0.1. Dependencies (<a href="https://github.com/tokio-rs/tokio-io"><code>tokio-io</code></a>,
<a href="https://github.com/rust-lang-nursery/futures-rs"><code>futures</code></a>, <a href="https://github.com/carllerche/mio"><code>mio</code></a>, etc&hellip;) have not had their versions incremented. This
allows the <code>tokio</code> crate to be released with minimal ecosystem disruption.</p>

<p>The plan is to let the changes made in this release get some usage before
committing to them. Any fixes that require breaking changes will be able to be
done at the same time as the release to all the other crates. The goal is for
this to happen in 6-8 weeks. So please try out the changes released today and
provide feedback.</p>

<h2 id="rapid-iteration">Rapid iteration</h2>

<p>This is just the beginning. Tokio has ambitious goals to provide additional
functionality to get a great &ldquo;out of the box&rdquo; experience building asynchronous
I/O applications in Rust.</p>

<p>In order to reach these goals as fast as possible without causing unnecessary
ecosystem disruption, we will be taking a few steps.</p>

<p>First, similarly to the <a href="#"><code>futures</code> 0.2 release</a>, the <code>tokio</code> crate will be
transitioned to be more of a facade. Traits and types will be broken up into a
number of sub crates and re-exported by <code>tokio</code>. Application authors will be
able to depend directly on <code>tokio</code> while library authors will pick and choose
the specific Tokio components that they wish to use as part of their libraries.</p>

<p>Each sub crate will clearly indicate its stability level. Obviously, there is an
upcoming breaking change with the futures 0.2 release, but after that,
fundamental building blocks will aim to remain stable for at least a year. More
experimental crates will reserve the right to issue breaking changes at a
quicker pace.</p>

<p>This means that the <code>tokio</code> crate itself will be able to iterate at a faster
pace while the library ecosystem remains stable.</p>

<p>The pre 0.2 period will also be a period of experimentation. Additional
functionality will be added to Tokio in an experimental capacity. Before an 0.2
release, an RFC will be posted covering the functionality that we would like to
include in that release.</p>

<h2 id="open-question">Open question</h2>

<p>One remaining question is what to do about <code>tokio-proto</code>. It was released as
part of the initial Tokio release. Since then, the focus has shifted and that
crate has not received enough attention.</p>

<p>I posted an issue to discuss what to do with that crate
<a href="https://github.com/tokio-rs/tokio/issues/118">here</a></p>

<h2 id="looking-forward">Looking Forward</h2>

<p>Please try out the changes released today. Again, the next couple of months are a period
of experimentation before we commit on the next release. So, now is the time to try things
out and provide feedback.</p>

<p>During this time, we&rsquo;ll be integrating this work to build out higher-level
primitives in <a href="https://github.com/tower-rs/tower">Tower</a>, which is being driven by the production operational needs
of the <a href="https://github.com/runconduit/conduit">Conduit</a> project.</p>

<div style="text-align:right">&mdash;Carl Lerche</div>

        
        <div class="tk-next"><b>下一篇</b>：<a href = /blog/2017-09-tokio-reform/>
         An RFC for a Tokio revamp</a></div>
      </div>
    </div>
  </div>
</div>

    <footer class="tk-footer">
      <div class="text-muted tk-footer-gray d-flex justify-content-between">
        <div class="tk-footer-info">
          版权所有 © 2018 <a href="https://tokio.rs">Tokio 项目（作）</a> & <a href="https://hltj.me">灰蓝天际（译）</a>
        </div>
        <div class="tk-footer-social">
          <a href="https://twitter.com/tokio_rs" class="text-muted"><i class="fa fa-twitter" aria-hidden="true"></i></a>
          <a href="https://github.com/tokio-rs/tokio" class="text-muted"><i class="fa fa-github" aria-hidden="true"></i></a>
        </div>
      </div>
    </footer>

    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
    <script src="https://tokio-cn.github.io/js/bootstrap.min.js"></script>
    <script src="https://tokio-cn.github.io/js/highlight.js"></script>
    <script>
      $(function () {
        $("pre code").each(function(i, block) {
          
          if (block.className.indexOf('language-rust') >= 0) {
            var new_content = '';
            var lines = block.textContent.split('\n');
            for (var i = 0; i < lines.length; i++) {
              if (lines[i].indexOf('# ') == 0 || lines[i] == '#') {
                continue
              }
              new_content += lines[i].trimRight() + '\n';
            }
            block.textContent = new_content.replace(/\n\n\n/g, "\n\n").trimRight();
          }
          hljs.highlightBlock(block);
        });
      });
    </script>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-122396021-1', 'auto');
ga('send', 'pageview');
</script>

  </body>
</html>


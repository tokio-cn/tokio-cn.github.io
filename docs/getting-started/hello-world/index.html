<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <link rel="apple-touch-icon" sizes="120x120" href="https://tokio-cn.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://tokio-cn.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://tokio-cn.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://tokio-cn.github.io/manifest.json">
    <link rel="mask-icon" href="https://tokio-cn.github.io/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">

    
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/bootstrap-reboot.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/bootstrap.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/tokio.css">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/>

    
    <link rel="alternate" type="application/rss+xml" href="https://tokio-cn.github.io/blog/index.xml" />

    <title>
      
        Hello World! · Tokio 中文站
      
    </title>
  </head>
  <body>
    <header class="navbar navbar-expand navbar-dark flex-column flex-md-row tk-navbar">
      <a class="navbar-brand" href="https://tokio-cn.github.io/">
        <img src="https://tokio-cn.github.io/img/Tokio_Mark_White.png" class="align-middle" alt="">
      </a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link " href="https://tokio-cn.github.io/">首页</a>
          </li>
          <li class="nav-item">
            
            
            
            <a class="nav-link  active " href="https://tokio-cn.github.io/docs/getting-started/hello-world/">文档</a>
          </li>
          <li class="nav-item">
            
            <a class="nav-link " href="https://tokio-cn.github.io/community/">社区</a>
          </li>
          <li class="nav-item">
            
            
            <a class="nav-link " href="https://tokio-cn.github.io/blog/2018-10-doc-blitz/">博客</a>
          </li>
        </ul>
      </div>

      <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex">
        <li class="nav-item dropdown">
          <a class="nav-item nav-link dropdown-toggle mr-md-2" href="#" id="tk-langs" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            中文
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="tk-langs">
            <a class="dropdown-item active" href="#">中文</a>
            <a class="dropdown-item" href="https://tokio-zh.github.io/" rel="nofollow">官方中文</a>
            <a class="dropdown-item" href="https://tokio.rs" rel="nofollow">English</a>
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://github.com/tokio-rs/tokio" target="_blank" rel="noopener" aria-label="GitHub">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 499.36" focusable="false"><title>GitHub</title><path d="M256 0C114.64 0 0 114.61 0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34 0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49 0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75 0 0 21.49-6.88 70.4 26.24a242.65 242.65 0 0 1 128.18 0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69 0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41 0 34.22-.31 61.83-.31 70.23 0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37 0 256 0z" fill="currentColor" fill-rule="evenodd"/></svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://twitter.com/tokio_rs" target="_blank" rel="noopener" aria-label="Twitter">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 416.32" focusable="false"><title>Twitter</title><path d="M160.83 416.32c193.2 0 298.92-160.22 298.92-298.92 0-4.51 0-9-.2-13.52A214 214 0 0 0 512 49.38a212.93 212.93 0 0 1-60.44 16.6 105.7 105.7 0 0 0 46.3-58.19 209 209 0 0 1-66.79 25.37 105.09 105.09 0 0 0-181.73 71.91 116.12 116.12 0 0 0 2.66 24c-87.28-4.3-164.73-46.3-216.56-109.82A105.48 105.48 0 0 0 68 159.6a106.27 106.27 0 0 1-47.53-13.11v1.43a105.28 105.28 0 0 0 84.21 103.06 105.67 105.67 0 0 1-47.33 1.84 105.06 105.06 0 0 0 98.14 72.94A210.72 210.72 0 0 1 25 370.84a202.17 202.17 0 0 1-25-1.43 298.85 298.85 0 0 0 160.83 46.92" fill="currentColor"/></svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link p-2" href="https://gitter.im/tokio-rs/tokio" target="_blank" rel="noopener" aria-label="Gitter">
            <svg class="navbar-nav-svg" xmlns="http://www.w3.org/2000/svg" focusable="false"><title>Gitter</title><path fill="currentColor" d="M8.501 4.001H10.5V24H8.501V4.001zm6.999 0V24h-2V4.001h2zM3.5 0h2.001v15H3.5V0zm15 4.001h2V15h-2V4.001z"/></svg>
          </a>
        </li>
      </ul>
    </header>



<div class="container-fluid tk-docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 tk-sidebar">
      <form class="tk-search d-flex align-items-center">
        <span class="algolia-autocomplete algolia-autocomplete-left" style="position: relative; display: inline-block; direction: ltr;">
          <input class="form-control ds-input" id="search-input" placeholder="搜索……" autocomplete="off" spellcheck="false" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0" style="position: relative; vertical-align: top;" dir="auto" type="search">
          <pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant: normal; font-weight: 400; word-spacing: 0px; letter-spacing: normal; text-indent: 0px; text-rendering: optimizelegibility; text-transform: none;">w</pre>
          <span class="ds-dropdown-menu ds-with-1" style="position: absolute; top: 100%; left: 0px; z-index: 100; right: auto; display: none;" role="listbox" id="algolia-autocomplete-listbox-0">
            <div class="ds-dataset-1"></div>
          </span>
        </span>
        <button class="btn btn-link tk-search-docs-toggle d-md-none p-0 ml-3" type="button" data-toggle="collapse" data-target="#tk-docs-nav" aria-controls="tk-docs-nav" aria-expanded="false" aria-label="Toggle docs navigation"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false">
            <title>Menu</title><path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"></path></svg>
        </button>
      </form>

      <nav class="tk-links collapse" id="tk-docs-nav">
          
          
            
              <div class="tk-toc-item">
                <a class="tk-toc-link" href="https://tokio-cn.github.io/docs/overview/">
                  Tokio 是什么？
                </a>
              </div>
            
          
            
              
              <div class="tk-toc-item active">
                <a class="tk-toc-link" href="https://tokio-cn.github.io/docs/getting-started/hello-world/">
                  入门
                </a>
                <ul class="nav tk-sidenav">
                
                  <li><a href="https://tokio-cn.github.io/docs/getting-started/hello-world/" class="active">Hello World!</a></li>
                
                  <li><a href="https://tokio-cn.github.io/docs/getting-started/runtime-model/" class="">运行时模型</a></li>
                
                  <li><a href="https://tokio-cn.github.io/docs/getting-started/futures/" class="">Futures</a></li>
                
                  <li><a href="https://tokio-cn.github.io/docs/getting-started/tasks/" class="">Tasks</a></li>
                
                  <li><a href="https://tokio-cn.github.io/docs/getting-started/io/" class="">I/O with Tokio</a></li>
                
                  <li><a href="https://tokio-cn.github.io/docs/getting-started/chat/" class="">Example: A Chat Server</a></li>
                
                </ul>
              </div>
            
          
            
              
              <div class="tk-toc-item ">
                <a class="tk-toc-link" href="https://tokio-cn.github.io/docs/going-deeper/timers/">
                  深入
                </a>
                <ul class="nav tk-sidenav">
                
                  <li><a href="https://tokio-cn.github.io/docs/going-deeper/timers/" class="">Timers</a></li>
                
                  <li><a href="https://tokio-cn.github.io/docs/going-deeper/futures-mechanics/" class="">Essential combinators</a></li>
                
                  <li><a href="https://tokio-cn.github.io/docs/going-deeper/returning/" class="">Returning futures</a></li>
                
                  <li><a href="https://tokio-cn.github.io/docs/going-deeper/frames/" class="">Working with framed streams</a></li>
                
                  <li><a href="https://tokio-cn.github.io/docs/going-deeper/building-runtime/" class="">Building a runtime</a></li>
                
                </ul>
              </div>
            
          
            
              
              <div class="tk-toc-item ">
                <a class="tk-toc-link" href="https://tokio-cn.github.io/docs/internals/intro/">
                  Tokio 内部原理
                </a>
                <ul class="nav tk-sidenav">
                
                  <li><a href="https://tokio-cn.github.io/docs/internals/intro/" class="">Introduction</a></li>
                
                  <li><a href="https://tokio-cn.github.io/docs/internals/runtime-model/" class="">Runtime model</a></li>
                
                  <li><a href="https://tokio-cn.github.io/docs/internals/net/" class="">Non-blocking I/O</a></li>
                
                </ul>
              </div>
            
          
            
              <div class="tk-toc-item">
                <a class="tk-toc-link" href="https://docs.rs/tokio">
                  API 文档
                </a>
              </div>
            
          
      </nav>
    </div>
    <div class="d-none d-xl-block col-xl-2 tk-toc">
      <div class="section-nav">
        <nav id="TableOfContents">
<ul>
<li><a href="#creating-the-stream">Creating the stream</a></li>
<li><a href="#写数据">写数据</a></li>
<li><a href="#running-the-client-task">Running the client task</a>
<ul>
<li><a href="#下一步">下一步</a></li>
</ul></li>
</ul>
</nav>
      </div>
    </div>
    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 tk-content tk-docs">
      <h1 class="tk-title">Hello World!</h1>
      <div class="github-edit">
        <a class="fa fa-github" href="https://github.com/hltj/tokio-website-cn/tree/master/content/docs/getting-started/hello-world.md"> 在 GitHub 上编辑</a>
      </div>
      

<p>为了开始我们的 Tokio 之旅，我们会以惯例“hello world”开始<!--
-->。 This program will create a TCP stream and write &ldquo;hello, world!&rdquo; to the stream.
The difference between this and a Rust program that writes to a TCP stream without Tokio
is that this program won&rsquo;t block program execution when the stream is created or when
our &ldquo;hello, world!&rdquo; message is written to the stream.</p>

<p>在开始之前，你应该对 TCP stream 的工作原理有最基本的了解。
了解 Rust 的<a href="https://doc.rust-lang.org/std/net/struct.TcpStream.html">标准库实现</a><!--
-->也很有帮助。</p>

<p>我们开始吧。</p>

<p>首先，生成一个新的 crate。</p>

<pre><code class="language-bash">$ cargo new --bin hello-world
$ cd hello-world
</code></pre>

<p>接下来，添加必要的依赖项：</p>

<pre><code class="language-toml">[dependencies]
tokio = &quot;0.1&quot;
</code></pre>

<p>还有 <code>main.rs</code> 中的 crate 与类型：</p>

<pre><code class="language-rust"># #![deny(deprecated)]
extern crate tokio;

use tokio::io;
use tokio::net::TcpStream;
use tokio::prelude::*;
# fn main() {}
</code></pre>

<h1 id="creating-the-stream">Creating the stream</h1>

<p>第一步是创建 <code>TcpStream</code>。我们使用 Tokio 提供的 <code>TcpStream</code>
实现。</p>

<pre><code class="language-rust"># #![deny(deprecated)]
# extern crate tokio;
#
# use tokio::net::TcpStream;
fn main() {
    // Parse the address of whatever server we're talking to
    let addr = &quot;127.0.0.1:6142&quot;.parse().unwrap();
    let stream = TcpStream::connect(&amp;addr);

    // 后续片段写到这里……
}
</code></pre>

<p>接下来，我们定义  <code>client</code> 任务。这个异步任务会 create the stream
and then yield the stream once it&rsquo;s been created for additional processing.</p>

<pre><code class="language-rust"># #![deny(deprecated)]
# extern crate tokio;
#
# use tokio::net::TcpStream;
# use tokio::prelude::*;
# fn main() {
# let addr = &quot;127.0.0.1:6142&quot;.parse().unwrap();
let hello_world = TcpStream::connect(&amp;addr).and_then(|stream| {
    println!(&quot;created stream&quot;);

    // 这里处理 stream。

    Ok(())
})
.map_err(|err| {
    // 所有任务必须具有 `()` 类型的 `Error`。这会强制进行
    // 错误处理，并且有助于避免静默故障。
    //
    // 在本例中，只是将错误记录到 STDOUT（标准输出）。
    println!(&quot;connection error = {:?}&quot;, err);
});
# }
</code></pre>

<p>调用 <code>TcpStream::connect</code> 会返回一个已创建的 TCP stream 的 <a href="https://docs.rs/futures/0.1/futures/future/trait.Future.html"><code>Future</code></a>。
我们会在指南的后续部分学习更多关于 [<code>Futures</code>] 的内容，不过现在你可以将
[<code>Stream</code>] as a value that represents something that will eventually happen in the
future (in this case the stream will be created). This means that <code>TcpStream::connect</code> does
not wait for the stream to be created before it returns. Rather it returns immediately
with a value representing the work of creating a TCP stream. We&rsquo;ll see down below when this work
<em>actually</em> gets executed.</p>

<p>The <code>and_then</code> method yields the stream once it has been created. <code>and_then</code> 是<!--
-->定义了如何处理异步作业的组合子函数的一个示例。</p>

<p>每个组合子函数都获得必要状态的所有权以及用<!--
-->以执行的回调，并返回一个新的有附加“步骤”顺次排入的 <code>Future</code><!--
-->。<code>Future</code> 是表示会在未来的某个时刻完成的<!--
-->某些计算的值。</p>

<p>值得重申的是返回的那些 future 都是惰性的，也就是说，在调用该组合子时不执行任何操作<!--
-->。相反，一旦所有异步步骤都已顺次排入，
最终的 <code>Future</code>（代表整个任务）就会“产生”（即运行）。这是<!--
-->之前定义的作业开始运行的时候。 In other words, the code
we&rsquo;ve written so far does not actually create a TCP stream.</p>

<p>我们稍后会更深入地探讨这些 future（以及 stream 与 sink 的相关概念）<!--
-->。</p>

<p>It&rsquo;s also important to note that we&rsquo;ve called <code>map_err</code> to convert whatever error
we may have gotten to <code>()</code> before we can actually run our future. This ensures that
we acknowledge errors.</p>

<p>Next, we will process the stream.</p>

<h1 id="写数据">写数据</h1>

<p>我们的目标是将 <code>&quot;hello world\n&quot;</code> 写入到 stream。</p>

<p>回到 <code>TcpStream::connect(addr).and_then</code> 块：</p>

<pre><code class="language-rust"># #![deny(deprecated)]
# extern crate tokio;
#
# use tokio::io;
# use tokio::prelude::*;
# use tokio::net::TcpStream;
# fn main() {
# let addr = &quot;127.0.0.1:6142&quot;.parse().unwrap();
let client = TcpStream::connect(&amp;addr).and_then(|stream| {
    println!(&quot;created stream&quot;);

    io::write_all(stream, &quot;hello world\n&quot;).then(|result| {
      println!(&quot;wrote to stream; success={:?}&quot;, result.is_ok());
      Ok(())
    })
})
# ;
# }
</code></pre>

<p>The <a href="https://docs.rs/tokio-io/0.1/tokio_io/io/fn.write_all.html"><code>io::write_all</code></a> function takes ownership of <code>stream</code>, returning a
<a href="https://docs.rs/futures/0.1/futures/future/trait.Future.html"><code>Future</code></a> that completes once the entire message has been written to the
stream. <code>then</code> is used to sequence a step that gets run once the write has
completed. In our example, we just write a message to <code>STDOUT</code> indicating that
the write has completed.</p>

<p>Note that <code>result</code> is a <code>Result</code> that contains the original stream. This allows us
to sequence additional reads or writes to the same stream. However, we have
nothing more to do, so we just drop the stream, which automatically closes it.</p>

<h1 id="running-the-client-task">Running the client task</h1>

<p>到目前为止，我们有一个表示程序会完成的作业的 <code>Future</code>，但是我们<!--
-->并没有真正运行它。需要一种方式来“产生”该作业。我们需要一个执行子。</p>

<p>执行子负责调度异步任务，使其<!--
-->完成。有很多执行子的实现可供选择，每个都有<!--
-->不同的优缺点。在本例中，我们会使用
<a href="https://docs.rs/tokio/0.1/tokio/runtime/index.html">Tokio 运行时</a> 的默认执行子。</p>

<pre><code class="language-rust"># #![deny(deprecated)]
# extern crate tokio;
# extern crate futures;
#
# use tokio::prelude::*;
# use futures::future;
# fn main() {
# let client = future::ok(());
println!(&quot;About to create the stream and write to it...&quot;);
tokio::run(client);
println!(&quot;Stream has been created and written to.&quot;);
# }
</code></pre>

<p><code>tokio::run</code> 会启动该运行时，阻塞当前进程直到所有已产生的任务<!--
-->都已完成并且所有资源（如文件与套接字）都已释放。</p>

<p>至此，我们仅仅在执行子上执行了单个任务，因此 <code>client</code> 任务<!--
-->是阻塞 <code>run</code> 返回的唯一任务。 Once <code>run</code> has returned we can be sure
that our Future has been run to completion.</p>

<p>可以在<a href="https://github.com/tokio-rs/tokio/blob/master/examples/hello_world.rs">这里</a>找到完整的示例。</p>

<h2 id="下一步">下一步</h2>

<p>我们这里只是对 Tokio 及其异步模型小试牛刀。本指南的下一页<!--
-->会开始深入探讨 Tokio 运行时模型。</p>

      
      
        <div class="tk-next">
          <b>下一篇</b>：<a href ="/docs/getting-started/runtime-model/">运行时模型</a>
        </div>
      
    </main>
  </div>
</div>

    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
    <script src="https://tokio-cn.github.io/js/bootstrap.min.js"></script>
    <script src="https://tokio-cn.github.io/js/highlight.js"></script>
    <script>
      $(function () {
        $("pre code").each(function(i, block) {
          
          if (block.className.indexOf('language-rust') >= 0) {
            var new_content = '';
            var lines = block.textContent.split('\n');
            for (var i = 0; i < lines.length; i++) {
              if (lines[i].indexOf('# ') == 0 || lines[i] == '#') {
                continue
              }
              new_content += lines[i].trimRight() + '\n';
            }
            block.textContent = new_content.replace(/\n\n\n/g, "\n\n").trimRight();
          }
          hljs.highlightBlock(block);
        });
      });
    </script>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script type="text/javascript"> docsearch({
    apiKey: 'd7b5b785798fe748621bcaa8301a2201',
    indexName: 'tokio',
    inputSelector: '#search-input',
    debug: false 
    });
    </script>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-122396021-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  </body>
</html>


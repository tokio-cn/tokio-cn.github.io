<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <link rel="apple-touch-icon" sizes="120x120" href="https://tokio-cn.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://tokio-cn.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://tokio-cn.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://tokio-cn.github.io/manifest.json">
    <link rel="mask-icon" href="https://tokio-cn.github.io/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">

    
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/bootstrap-reboot.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/bootstrap.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://tokio-cn.github.io/css/tokio.css">

    
    <link rel="alternate" type="application/rss+xml" href="https://tokio-cn.github.io/blog/index.xml" />

    <title>Hello World!</title>
  </head>
  <body>
    <header class="navbar navbar-light navbar-toggleable-md bd-navbar">
      <nav class="tk-main-nav">
        <div class="d-flex justify-content-between hidden-lg-up">
            <a href="https://tokio-cn.github.io/" class="navbar-brand">
              <img src="https://tokio-cn.github.io/img/logo.png" class="align-middle" alt="">
            </a>
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#tk-main-nav" aria-label="Toggle navigation" aria-controls="tk-main-nav" aria-expanded="false">
              <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        <div class="navbar-collapse collapse" id="tk-main-nav">
          <ul class="nav navbar-nav">
            <li class="nav-item hd-lg-down">
              <a class="navbar-brand" href="https://tokio-cn.github.io/"><img src="https://tokio-cn.github.io/img/logo.png" class="align-middle" alt=""></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://tokio-cn.github.io/">首页 <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://tokio-cn.github.io/docs/getting-started/hello-world/">文档</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://tokio-cn.github.io/community/">社区</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://tokio-cn.github.io/blog/2018-05-tokio-fs/">博客</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>



<div class="tk-pageheader">
  <div class="container">
    <h1 class="display-4">Hello World!</h1>
    <p class="lead"></p>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-3">

      <nav class="leftnav">
        <div class="" id="">
          <h5>入门</h5>
          <hr/>

          <div class="" id="">
            <ul class="nav">
              
              <li class="active">
                <a href="https://tokio-cn.github.io/docs/getting-started/hello-world/" >Hello World!</a>
              </li>
              
              <li class="active">
                <a href="https://tokio-cn.github.io/docs/getting-started/runtime-model/" class="text-muted">Runtime Model</a>
              </li>
              
              <li class="active">
                <a href="https://tokio-cn.github.io/docs/getting-started/futures/" class="text-muted">Futures</a>
              </li>
              
              <li class="active">
                <a href="https://tokio-cn.github.io/docs/getting-started/tasks/" class="text-muted">Tasks</a>
              </li>
              
              <li class="active">
                <a href="https://tokio-cn.github.io/docs/getting-started/io/" class="text-muted">I/O with Tokio</a>
              </li>
              
              <li class="active">
                <a href="https://tokio-cn.github.io/docs/getting-started/chat/" class="text-muted">Example: A Chat Server</a>
              </li>
              
            </ul>
          </div>

          <h5>深入</h5>
          <hr/>

          <div class="" id="">
            <ul class="nav">
              
              <li class="active">
                <a href="https://tokio-cn.github.io/docs/going-deeper/timers/" class="text-muted">Timers</a>
              </li>
              
              <li class="active">
                <a href="https://tokio-cn.github.io/docs/going-deeper/futures-mechanics/" class="text-muted">Essential combinators</a>
              </li>
              
              <li class="active">
                <a href="https://tokio-cn.github.io/docs/going-deeper/returning/" class="text-muted">Returning futures</a>
              </li>
              
              <li class="active">
                <a href="https://tokio-cn.github.io/docs/going-deeper/frames/" class="text-muted">Working with framed streams</a>
              </li>
              
              <li class="active">
                <a href="https://tokio-cn.github.io/docs/going-deeper/building-runtime/" class="text-muted">Building a runtime</a>
              </li>
              
            </ul>
          </div>

          <br/>
          <h5>参考</h5>
          <hr/>

          <div class="" id="">
            <ul class="nav">
              <li class="active">
                <a href="https://docs.rs/tokio" class="text-muted"><code>tokio</code> API docs</a>
              </li>
              <li class="active">
                <a href="https://docs.rs/futures/0.1" class="text-muted"><code>futures</code> API docs</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

    </div>
    <div class="col-md-9">
      <div class="tk-content">
        <div class="github-edit">
            <a class="fa fa-github" href="https://github.com/hltj/tokio-website-cn/tree/master/content/docs/getting-started/hello-world.md"> 在 GitHub 上编辑</a>
        </div>
        

<p>To kick off our tour of Tokio, we will start with the obligatory &ldquo;hello world&rdquo;
example. This server will listen for incoming connections. Once a connection is
received, it will write &ldquo;hello world&rdquo; to the client and close the connection.</p>

<p>Let&rsquo;s get started.</p>

<p>First, generate a new crate.</p>

<pre><code class="language-shell">$ cargo new --bin hello-world
$ cd hello-world
</code></pre>

<p>Next, add the necessary dependencies:</p>

<pre><code class="language-toml">[dependencies]
tokio = &quot;0.1&quot;
</code></pre>

<p>and the crates and types into scope in <code>main.rs</code>:</p>

<pre><code class="language-rust"># #![deny(deprecated)]
extern crate tokio;

use tokio::io;
use tokio::net::TcpListener;
use tokio::prelude::*;
# fn main() {}
</code></pre>

<h2 id="writing"><a href="#writing">Writing the server</a></h2>

<p>The first step is to bind a <code>TcpListener</code> to a local port. We use the
<code>TcpListener</code> implementation provided by Tokio.</p>

<pre><code class="language-rust"># #![deny(deprecated)]
# extern crate tokio;
#
# use tokio::io;
# use tokio::net::TcpListener;
# use tokio::prelude::*;
fn main() {
    let addr = &quot;127.0.0.1:6142&quot;.parse().unwrap();
    let listener = TcpListener::bind(&amp;addr).unwrap();

    // Following snippets come here...
}
</code></pre>

<p>Next, we define the server task. This asynchronous task will listen for incoming
connections on the bound listener and process each accepted connection.</p>

<pre><code class="language-rust"># #![deny(deprecated)]
# extern crate tokio;
#
# use tokio::io;
# use tokio::net::TcpListener;
# use tokio::prelude::*;
# fn main() {
#     let addr = &quot;127.0.0.1:6142&quot;.parse().unwrap();
#     let listener = TcpListener::bind(&amp;addr).unwrap();
let server = listener.incoming().for_each(|socket| {
    println!(&quot;accepted socket; addr={:?}&quot;, socket.peer_addr().unwrap());

    // Process socket here.

    Ok(())
})
.map_err(|err| {
    // All tasks must have an `Error` type of `()`. This forces error
    // handling and helps avoid silencing failures.
    //
    // In our example, we are only going to log the error to STDOUT.
    println!(&quot;accept error = {:?}&quot;, err);
});
# }
</code></pre>

<p>Combinator functions are used to define asynchronous tasks. The call to
<code>listener.incoming()</code> returns a <a href="https://docs.rs/futures/0.1/futures/stream/trait.Stream.html"><code>Stream</code></a> of accepted connections. A <a href="https://docs.rs/futures/0.1/futures/stream/trait.Stream.html"><code>Stream</code></a>
is kind of like an asynchronous iterator.</p>

<p>Each combinator function takes ownership of necessary state as well as the
callback to perform and returns a new <code>Future</code> or <code>Stream</code> that has the
additional &ldquo;step&rdquo; sequenced.</p>

<p>Returned futures and streams are lazy, i.e., no work is performed when calling
the combinator. Instead, once all the asynchronous steps are sequenced, the
final <code>Future</code> (representing the task) is spawned on an executor. This is when
the work that was previously defined starts getting run.</p>

<p>We will be digging into futures and streams later on.</p>

<h2 id="spawning"><a href="#spawning">Spawning the task</a></h2>

<p>Executors are responsible for scheduling asynchronous tasks, driving them to
completion. There are a number of executor implementations to choose from, each have
different pros and cons. In this example, we will use the <a href="https://docs.rs/tokio/0.1/tokio/runtime/index.html">Tokio runtime</a>.</p>

<p>The Tokio runtime is a pre-configured runtime for asynchronous applications. It
includes a thread pool as the default executor. This thread pool is tuned for
usage in asynchronous applications.</p>

<pre><code class="language-rust"># #![deny(deprecated)]
# extern crate tokio;
# extern crate futures;
#
# use tokio::io;
# use tokio::net::TcpListener;
# use tokio::prelude::*;
# use futures::future;
# fn main() {
# let server = future::ok(());

println!(&quot;server running on localhost:6142&quot;);
tokio::run(server);
# }
</code></pre>

<p><code>tokio::run</code> starts the runtime, blocking the current thread until
all spawned tasks have completed and all resources (like TCP sockets) have been
dropped. Spawning a task using <a href="https://docs.rs/tokio/0.1/tokio/fn.spawn.html"><code>tokio::spawn</code></a> <strong>must</strong> happen from within the
context of a <a href="https://docs.rs/tokio/0.1/tokio/runtime/index.html">runtime</a>.</p>

<p>So far, we only have a single task running on the executor, so the <code>server</code> task
is the only one blocking <code>run</code> from returning.</p>

<p>Next, we will process the inbound sockets.</p>

<h2 id="writing-data"><a href="#writing-data">Writing Data</a></h2>

<p>Our goal is to write <code>&quot;hello world\n&quot;</code> on each accepted socket. We will do this
by defining a new asynchronous task to do the write and spawning that task on
the same <code>current_thread</code> executor.</p>

<p>Going back to the <code>incoming().for_each</code> block.</p>

<pre><code class="language-rust"># #![deny(deprecated)]
# extern crate tokio;
#
# use tokio::io;
# use tokio::net::TcpListener;
# use tokio::prelude::*;
# fn main() {
#     let addr = &quot;127.0.0.1:6142&quot;.parse().unwrap();
#     let listener = TcpListener::bind(&amp;addr).unwrap();
let server = listener.incoming().for_each(|socket| {
    println!(&quot;accepted socket; addr={:?}&quot;, socket.peer_addr().unwrap());

    let connection = io::write_all(socket, &quot;hello world\n&quot;)
        .then(|res| {
            println!(&quot;wrote message; success={:?}&quot;, res.is_ok());
            Ok(())
        });

    // Spawn a new task that processes the socket:
    tokio::spawn(connection);

    Ok(())
})
# ;
# }
</code></pre>

<p>We are defining another asynchronous task. This task will take ownership of the
socket, write the message on that socket, then complete. The <code>connection</code>
variable holds the final task. Again, no work has yet been performed.</p>

<p><code>tokio::spawn</code> is used to spawn the task on the runtime. Because the
<code>server</code> future is running on the runtime, we are able to spawn further tasks.
<code>tokio::spawn</code> will panic if called from outside of the runtime.</p>

<p>The <a href="https://docs.rs/tokio-io/0.1/tokio_io/io/fn.write_all.html"><code>io::write_all</code></a> function takes ownership of <code>socket</code>, returning a
<a href="https://docs.rs/futures/0.1/futures/future/trait.Future.html"><code>Future</code></a> that completes once the entire message has been written to the
socket. <code>then</code> is used to sequence a step that gets run once the write has
completed. In our example, we just write a message to <code>STDOUT</code> indicating that
the write has completed.</p>

<p>Note that <code>res</code> is a <code>Result</code> that contains the original socket. This allows us
to sequence additional reads or writes on the same socket. However, we have
nothing more to do, so we just drop the socket, which closes it.</p>

<p>You can find the full example <a href="https://github.com/tokio-rs/tokio/blob/master/examples/hello_world.rs">here</a></p>

<h2 id="next-steps"><a href="#next-steps">Next steps</a></h2>

<p>We&rsquo;ve only dipped our toes in Tokio and its asynchronous model. The next page in
the guide, will start digging deeper into the Tokio runtime model.</p>

        
        <div class="tk-next"><b>Next up</b>: <a href = /docs/getting-started/runtime-model/>
         Runtime Model</a></div>
      </div>
    </div>
  </div>
</div>

    <footer class="tk-footer">
      <div class="text-muted tk-footer-gray d-flex justify-content-between">
        <div class="tk-footer-info">
          版权所有 © 2018 <a href="https://tokio.rs">Tokio 项目</a> & <a href="https://hltj.me">灰蓝天际</a> 
        </div>
        <div class="tk-footer-social">
          <a href="https://twitter.com/tokio_rs" class="text-muted"><i class="fa fa-twitter" aria-hidden="true"></i></a>
          <a href="https://github.com/tokio-rs/tokio" class="text-muted"><i class="fa fa-github" aria-hidden="true"></i></a>
        </div>
      </div>
    </footer>

    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
    <script src="https://tokio-cn.github.io/js/bootstrap.min.js"></script>
    <script src="https://tokio-cn.github.io/js/highlight.js"></script>
    <script>
      $(function () {
        $("pre code").each(function(i, block) {
          
          if (block.className.indexOf('language-rust') >= 0) {
            var new_content = '';
            var lines = block.textContent.split('\n');
            for (var i = 0; i < lines.length; i++) {
              if (lines[i].indexOf('# ') == 0 || lines[i] == '#') {
                continue
              }
              new_content += lines[i].trimRight() + '\n';
            }
            block.textContent = new_content.replace(/\n\n\n/g, "\n\n").trimRight();
          }
          hljs.highlightBlock(block);
        });
      });
    </script>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-122396021-1', 'auto');
ga('send', 'pageview');
</script>

  </body>
</html>

